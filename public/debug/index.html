<!DOCTYPE html>

<html>
  <head>
    <style>

    </style>
    <link href="//netdna.bootstrapcdn.com/twitter-bootstrap/2.2.1/css/bootstrap-combined.min.css" rel="stylesheet">
  </head>
  <body>

<h3>Binds</h3>
<ul id="binds"></ul>

    <script src="http://code.jquery.com/jquery.js"></script>
    <script src="/socket.io/socket.io.js"></script>
    <script src="/olinexpo.js"></script>
    <script>

var lastbind = {};

var api = olinexpo(function () {
  api._listenBinds(function (bind) {
    var $row = $('#binds li[data-ant=' + JSON.stringify(bind.ant) + ']');
    if (!$row[0]) {
      $row = $('<li data-ant=' + JSON.stringify(bind.ant) + '><h4></h4><span>Time since last bind: <b></b></span></li>').appendTo($('#binds'));
      $row.find('h4').text(bind.ant);
    }

    lastbind[bind.ant] = bind;
  })
});

function timesince (d) {
  var delta = (Date.now() - d) / 1000;
  var seconds = delta % 60;
  var minutes = (0|(delta / 60)) % 60;
  var hours = (0|(delta / 3600));
  var str = hours + ' hours, ' + minutes + ' minutes, ' + seconds + ' seconds';
  if (delta > 10) {
    str = '<span style="color: red">' + str + '</span>';
  }
  return str;
}

setInterval(function () {
  Object.keys(lastbind).forEach(function (antid) {
    var bind = lastbind[antid];
    var $row = $('#binds li[data-ant=' + JSON.stringify(antid) + ']');
    $row.find('b').html(timesince(bind.time));
  });
}, 200);

    </script>
  </body>
</html>