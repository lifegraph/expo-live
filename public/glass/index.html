<h2>User Locations</h2>
<div>
</div>

<script src="http://code.jquery.com/jquery.js"></script>
<script src="/socket.io/socket.io.js"></script>
<script src="/olinexpo.js"></script>
<script>

function refresh () {
  $('div').html('');

  api.state.users.forEach(function (user) {
    var bind = api.state.binds.filter(function (bind) {
      return bind.user == user.id;
    }).pop();
    if (bind) {
      var location = api.state.locations.filter(function (location) {
        return location.id == bind.location;
      })[0];
    }
    $('div').append($('<p>').text(user.name + ' - (' + (bind ? String(new Date(bind.time)).split(' ')[4] + ' ' + bind.ant + '=>' + bind.colony : '') + ') ' + (location ? location.floor + location.index : '')));
  });
}

var api = olinexpo({
  onconnect: function () {
  },
  onbindcreate: function (bind) {
    refresh();
  },
  onantupdate: function (ant) {
    refresh();
  },
  oncolonyupdate: function (colony) {
    refresh();
  },
  onload: function () {
    refresh();
  }
});

</script>