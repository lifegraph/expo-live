<h2>Battery test</h2>
<div>
</div>
<p>click this to <a href="/destroyallbinddataiamserious" onclick="return confirm('Are you sure you want to navigate to /destroyallbinddataiamserious and destroy everhything?')">CLEAR EVERYTHINGGGGGGGGG in the database!!!</a></p>

<link href="//netdna.bootstrapcdn.com/twitter-bootstrap/2.2.1/css/bootstrap-combined.min.css" rel="stylesheet">
<script src="http://code.jquery.com/jquery.js"></script>
<script src="/socket.io/socket.io.js"></script>
<script src="/olinexpo.js"></script>
<script>

var ants = {};

var api = olinexpo({
  onconnect: function () {
  },
  onbindcreate: function (bind) {
    if (!ants[bind.ant]) {
      ants[bind.ant] = {first: bind, last: null}
    }
    ants[bind.ant].last = bind;
    console.log('bind received');
  },
  onantupdate: function (ant) {
  },
  oncolonyupdate: function (colony) {
  },
  onload: function () {
  }
});

function refresh () {
  $('div').html('');
  for (var antid in ants) {
    var ant = ants[antid];
    var start = ant.first.time, strstart = String(new Date(start)).split(/\s+/g).slice(0, 5).join(' ');
    var end = ant.last.time, strend = String(new Date(end)).split(/\s+/g).slice(0, 5).join(' ')
    var running_seconds = Math.round((end - start)/1000);
    var latest_seconds = Math.round((Date.now() - end)/1000);
    $('div').append(
      '<h3>Ant: ' + antid + ' <small class="muted">' + 
        '<b>Start:</b>' + strstart +
        '&nbsp;&nbsp;&nbsp;<b>Latest:</b>' + strend + '</small></h3>' +
      '<blockquote>' +
      '<i>time running:</i> ' + running_seconds + ' seconds ago<br>' +
      (latest_seconds > 10 ? '<span style="color: red">' : '') + '<i>time since latest:</i> ' + latest_seconds + ' seconds ago' + (latest_seconds > 10 ? '</span>' : '') +
      '</blockquote>');
  }
}
setInterval(refresh, 100);

</script>