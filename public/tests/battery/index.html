<h2>Battery test</h2>
<div>
</div>
<p>click this to <a href="/destroyallbinddataiamserious" onclick="return confirm('Are you sure you want to navigate to /destroyallbinddataiamserious and destroy everhything?')">CLEAR EVERYTHINGGGGGGGGG in the database!!!</a></p>

<link href="//netdna.bootstrapcdn.com/twitter-bootstrap/2.2.1/css/bootstrap-combined.min.css" rel="stylesheet">
<script src="http://code.jquery.com/jquery.js"></script>
<script src="/socket.io/socket.io.js"></script>
<script src="/olinexpo.js"></script>
<script>

var ants = {};

var api = olinexpo({
  onconnect: function () {
    setInterval(refresh, 5000);
  },
  onbindcreate: function (bind) {
    console.log('bind received');
  },
  onantupdate: function (ant) {
  },
  oncolonyupdate: function (colony) {
  },
  onload: function () {
  }
});

function refresh () {
  $('div').html('');
  Object.keys(api.state.segments).forEach(function (antid) {
    $('div').append($('<h3>Ant: ' + antid + ' <a class="btn btn-mini btn-danger">Delete</a></h3>'))
      .on('click', '.btn', function () {
        if (confirm('Are you sure you wanna delete these binds?')) {
          $.ajax({
            type: 'DELETE',
            url: '/binds/?ant=' + antid,
            success: function (res, error) {
              console.log(error);
              window.location.reload();
            }
          });
        }
      });

    api.state.segments[antid].forEach(function (segment) {
      if (!segment) {
        return;
      }
      var start = segment.first.time, strstart = String(new Date(start)).split(/\s+/g).slice(0, 5).join(' ');
      var end = segment.last.time, strend = String(new Date(end)).split(/\s+/g).slice(0, 5).join(' ')
      var running_seconds = Math.round((end - start)/1000);
      var latest_seconds = Math.round((Date.now() - end)/1000);
      $('div').append($('<blockquote><span class="muted">' + 
          '<b>Start:</b>' + strstart +
          '&nbsp;&nbsp;&nbsp;<b>Latest:</b>' + strend + '</span><br>' +
        '<i>time running:</i> ' + running_seconds + ' seconds, ' + Math.round(running_seconds/60) + ' minutes<br>' +
        (latest_seconds > 10 ? '<span style="color: red">' : '') + '<i>time since latest:</i> ' + latest_seconds + ' seconds ago, ' + Math.round(latest_seconds/60) + ' minutes ago' + (latest_seconds > 10 ? '</span>' : '') +
        '</blockquote>'));
    });
  });
}

</script>