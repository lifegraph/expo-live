<h2>Battery test</h2>
<div>
</div>
<p>click this to <a href="/destroyallbinddataiamserious" onclick="return confirm('Are you sure you want to navigate to /destroyallbinddataiamserious and destroy everhything?')">CLEAR EVERYTHINGGGGGGGGG in the database!!!</a></p>

<link href="//netdna.bootstrapcdn.com/twitter-bootstrap/2.2.1/css/bootstrap-combined.min.css" rel="stylesheet">
<script src="http://code.jquery.com/jquery.js"></script>
<script src="/socket.io/socket.io.js"></script>
<script src="/olinexpo.js"></script>
<script>

var ants = {};

var api = olinexpo({
  onconnect: function () {
  },
  onbindcreate: function (bind) {
    if (!ants[bind.ant]) {
      ants[bind.ant] = {first: bind, last: null}
    }
    ants[bind.ant].last = bind;
    console.log(bind);
  },
  onantupdate: function (ant) {
  },
  oncolonyupdate: function (colony) {
  },
  onload: function () {
  }
});

function refresh () {
  try {
    for (var antid in ants) {
      var ant = ants[antid];
      $('div').html(
        '<h3>Ant: ' + antid + '</h3>' +
        '<blockquote>' +
        '<b>Start:</b>' + String(new Date(ant.first.time)) + '<br>' +
        '<b>Latest:</b>' + (String(new Date(ant.last.time))) + '<br>' + 
        '<b>time since latest:<b>' + Math.round((ant.last.time - Date.now())/1000) + ' seconds ago' +
        '</blockquote>');
    }
  } catch (e) {
    console.log(e);
  }
}
setInterval(refresh, 100);

</script>