<link href="//netdna.bootstrapcdn.com/twitter-bootstrap/2.2.1/css/bootstrap-combined.min.css" rel="stylesheet">
<script src="http://code.jquery.com/jquery.js"></script>
<script src="/socket.io/socket.io.js"></script>

<script>
function prettyDate (time) {
  return String(new Date(time)).split(/\s+/).slice(0, 5).join(' ')
}

function render () {
  $.ajax({
    type: 'GET',
    url: '/segments?drop=30',
    dataType: 'json',
    success: function (json) {
      console.log(Date.now());
      Object.keys(json).forEach(function (k) {
        json[k] = json[k].map(function (l) {
          return {
            "duration": l.duration / (1000*60) + ' minutes',
            "start": prettyDate(l.first.time),
            "end": prettyDate(l.last.time),
          };
        });
      });
      document.body.innerHTML = '<pre>' + JSON.stringify(json, null, ' ');
      setTimeout(render, 300);
    }
  });
}

render();
</script>